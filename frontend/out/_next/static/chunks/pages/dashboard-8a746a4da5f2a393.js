(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[724],{30206:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard",function(){return a(61252)}])},61252:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>q});var s=a(74848),r=a(96540),l=a(86715),o=a(78465),n=a.n(o),c=a(96365),i=a(20312),d=a.n(i),m=a(38869),x=a(91642),u=a(29644),h=a.n(u),b=a(13596);a(13246);let f=h()(n());d().setAppElement("#__next");let p=e=>{let t=new b.default;t.setFontSize(18),t.text("Art\xedculos con Bajo Stock",14,22);let a=[];e.forEach(e=>{let t=[e.nombre,e.stock_actual.toString(),e.stock_minimo.toString()];a.push(t)}),t.autoTable({head:[["Art\xedculo","Stock Actual","Stock M\xednimo"]],body:a,startY:30,styles:{fontSize:12},headStyles:{fillColor:[22,160,133]}}),t.save("articulos_bajo_stock.pdf")},g=e=>{let t=new b.default;t.setFontSize(18),t.text("Pr\xe9stamos Activos",14,22);let a=[];e.forEach(e=>{var t;let s=[e.articulo?e.articulo.nombre:"N/D",e.cantidad_restante.toString(),e.personal?e.personal.nombre:"N/D",new Date(e.fecha_prestamo).toLocaleDateString("es-CL"),(null===(t=e.motivo)||void 0===t?void 0:t.nombre)||"N/D"];a.push(s)}),t.autoTable({head:[["Art\xedculo","Cantidad Prestada","Prestado a","Fecha de Pr\xe9stamo","Motivo"]],body:a,startY:30,styles:{fontSize:12},headStyles:{fillColor:[22,160,133]}}),t.save("prestamos_activos.pdf")};function j(){let e=(0,l.useRouter)(),[t,a]=(0,r.useState)(0),[o,n]=(0,r.useState)(0),[c,i]=(0,r.useState)([]),[u,h]=(0,r.useState)(0),[b,j]=(0,r.useState)([]),[y,v]=(0,r.useState)(!1),[N,w]=(0,r.useState)(!1),[k,S]=(0,r.useState)(""),[E,D]=(0,r.useState)(""),C=async()=>{try{let e=await (0,x.f2)(),t=e.length,s=e.filter(e=>e.stock_actual<e.stock_minimo);a(t),n(s.length),i(s);let r=await (0,x.tI)();console.log("Historial de Pr\xe9stamo:",r);let l=r.filter(e=>e.cantidad_restante>0&&!e.fecha_devolucion);console.log("Pr\xe9stamos Activos Filtrados:",l);let o=l.reduce((e,t)=>e+t.cantidad_restante,0);h(o),j(l)}catch(e){console.error("Error al cargar datos en EstadisticasWidgets:",e),f.fire({icon:"error",title:"Error",text:"No se pudieron cargar los datos de estad\xedsticas."})}};(0,r.useEffect)(()=>{C()},[]);let M=async()=>{if(await C(),0===c.length){f.fire({icon:"info",title:"Sin Art\xedculos con Bajo Stock",text:"No hay art\xedculos con stock por debajo del m\xednimo."});return}v(!0)},Y=()=>{v(!1)},_=async()=>{if(await C(),0===b.length){f.fire({icon:"info",title:"Sin Pr\xe9stamos Activos",text:"No hay art\xedculos prestados en este momento."});return}w(!0)},A=()=>{w(!1)},P=c.filter(e=>e.nombre.toLowerCase().includes(k.toLowerCase())),T=b.filter(e=>{var t;let a=e.articulo?e.articulo.nombre.toLowerCase():"n/d",s=e.personal?e.personal.nombre.toLowerCase():"n/d",r=(null===(t=e.motivo)||void 0===t?void 0:t.nombre)?e.motivo.nombre.toLowerCase():"n/d",l=new Date(e.fecha_prestamo).toLocaleDateString("es-CL").toLowerCase(),o=E.toLowerCase();return a.includes(o)||s.includes(o)||r.includes(o)||l.includes(o)});return(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-6 mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center bg-white p-6 rounded-lg shadow hover:shadow-lg transition-shadow cursor-pointer",onClick:()=>e.push("/stock/historial-stock"),children:[(0,s.jsx)(m.X3y,{className:"text-4xl text-blue-500 mr-4"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-gray-700",children:"Total Productos"}),(0,s.jsx)("p",{className:"text-3xl font-bold text-gray-800",children:t})]})]}),(0,s.jsxs)("div",{className:"flex items-center bg-white p-6 rounded-lg shadow hover:shadow-lg transition-shadow cursor-pointer",onClick:M,children:[(0,s.jsx)(m.eHT,{className:"text-4xl text-red-500 mr-4"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-gray-700",children:"Bajo Stock"}),(0,s.jsx)("p",{className:"text-3xl font-bold text-red-600",children:o})]})]}),(0,s.jsxs)("div",{className:"flex items-center bg-white p-6 rounded-lg shadow hover:shadow-lg transition-shadow cursor-pointer",onClick:_,children:[(0,s.jsx)(m.p45,{className:"text-4xl text-purple-500 mr-4"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-gray-700",children:"Pr\xe9stamos"}),(0,s.jsx)("p",{className:"text-3xl font-bold text-purple-600",children:u})]})]})]}),(0,s.jsxs)(d(),{isOpen:y,onRequestClose:Y,contentLabel:"Art\xedculos con Bajo Stock",className:"bg-white rounded-lg shadow-lg max-w-4xl mx-auto p-6 overflow-auto",overlayClassName:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"Art\xedculos con Bajo Stock"}),(0,s.jsx)("button",{onClick:Y,className:"text-gray-600 hover:text-gray-800",children:(0,s.jsx)(m.eHT,{size:24})})]}),(0,s.jsxs)("div",{className:"mb-4 flex flex-col sm:flex-row sm:justify-between sm:items-center space-y-2 sm:space-y-0",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(m.CKj,{className:"text-gray-500 mr-2"}),(0,s.jsx)("input",{type:"text",placeholder:"Buscar art\xedculo...",value:k,onChange:e=>S(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsx)("div",{className:"flex space-x-2",children:(0,s.jsxs)("button",{onClick:()=>p(P),className:"flex items-center bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700",children:[(0,s.jsx)(m.a4x,{className:"mr-2"}),"Exportar a PDF"]})})]}),(0,s.jsx)("div",{className:"overflow-y-auto max-h-96",children:(0,s.jsxs)("table",{className:"min-w-full border",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"bg-gray-200",children:[(0,s.jsx)("th",{className:"py-2 px-4 border border-black text-left",children:"Art\xedculo"}),(0,s.jsx)("th",{className:"py-2 px-4 border border-black text-left",children:"Stock Actual"}),(0,s.jsx)("th",{className:"py-2 px-4 border border-black text-left",children:"Stock M\xednimo"})]})}),(0,s.jsx)("tbody",{children:P.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"py-2 px-4 border border-black",children:e.nombre}),(0,s.jsx)("td",{className:"py-2 px-4 border border-black",children:e.stock_actual}),(0,s.jsx)("td",{className:"py-2 px-4 border border-black",children:e.stock_minimo})]},e.id))})]})})]}),(0,s.jsxs)(d(),{isOpen:N,onRequestClose:A,contentLabel:"Pr\xe9stamos Activos",className:"bg-white rounded-lg shadow-lg max-w-6xl mx-auto p-6 overflow-auto",overlayClassName:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"Pr\xe9stamos Activos"}),(0,s.jsx)("button",{onClick:A,className:"text-gray-600 hover:text-gray-800",children:(0,s.jsx)(m.p45,{size:24})})]}),(0,s.jsxs)("div",{className:"mb-4 flex flex-col sm:flex-row sm:justify-between sm:items-center space-y-2 sm:space-y-0",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(m.CKj,{className:"text-gray-500 mr-2"}),(0,s.jsx)("input",{type:"text",placeholder:"Buscar pr\xe9stamo...",value:E,onChange:e=>D(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),(0,s.jsx)("div",{className:"flex space-x-2",children:(0,s.jsxs)("button",{onClick:()=>g(T),className:"flex items-center bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700",children:[(0,s.jsx)(m.a4x,{className:"mr-2"}),"Exportar a PDF"]})})]}),(0,s.jsx)("div",{className:"overflow-y-auto max-h-96",children:(0,s.jsxs)("table",{className:"min-w-full border",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"bg-gray-200",children:[(0,s.jsx)("th",{className:"py-2 px-4 border border-black text-left",children:"Art\xedculo"}),(0,s.jsx)("th",{className:"py-2 px-4 border border-black text-left",children:"Cantidad Prestada"}),(0,s.jsx)("th",{className:"py-2 px-4 border border-black text-left",children:"Prestado a"}),(0,s.jsx)("th",{className:"py-2 px-4 border border-black text-left",children:"Fecha de Pr\xe9stamo"}),(0,s.jsx)("th",{className:"py-2 px-4 border border-black text-left",children:"Motivo"})]})}),(0,s.jsx)("tbody",{children:T.map(e=>{var t;let a=e.articulo?e.articulo.nombre:"N/D",r=e.personal?e.personal.nombre:"N/D",l=e.personal?e.personal.correo_institucional:"",o=new Date(e.fecha_prestamo).toLocaleDateString("es-CL"),n=(null===(t=e.motivo)||void 0===t?void 0:t.nombre)?e.motivo.nombre:"N/D";return(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"py-2 px-4 border border-black",children:a}),(0,s.jsx)("td",{className:"py-2 px-4 border border-black",children:e.cantidad_restante}),(0,s.jsxs)("td",{className:"py-2 px-4 border border-black",children:[r,l&&(0,s.jsx)("div",{className:"text-xs text-gray-500",children:l})]}),(0,s.jsx)("td",{className:"py-2 px-4 border border-black",children:o}),(0,s.jsx)("td",{className:"py-2 px-4 border border-black",children:n})]},e.id)})})]})})]})]})}var y=a(77037),v=a(85787);let N={RECENTES:"Recientes",ENTRADA:"Entrada",SALIDA:"Salida",CAMBIO_ESTADO:"Cambio de Estado",NUEVO_ARTICULO:"Nuevo Articulo",PRESTAMO:"Prestamo",REGRESADO:"Regresado"},w={Entrada:(0,s.jsx)(y.DZh,{}),Salida:(0,s.jsx)(y.GiA,{}),"Nuevo Articulo":(0,s.jsx)(y.rrY,{}),Prestamo:(0,s.jsx)(y.qIA,{}),Regresado:(0,s.jsx)(y.tMu,{}),"Cambio de Estado":(0,s.jsx)(y.yk7,{})},k={Entrada:"green",Salida:"red","Nuevo Articulo":"blue",Prestamo:"purple",Regresado:"orange","Cambio de Estado":"yellow"};function S(){let[e,t]=(0,r.useState)([]),[a,l]=(0,r.useState)([]),[o,n]=(0,r.useState)(null),[c,i]=(0,r.useState)(N.RECENTES),d=(0,r.useRef)(null),m=async()=>{try{let e=(await (0,x.J3)()).sort((e,t)=>new Date(t.fecha)-new Date(e.fecha));t(e),n(null)}catch(e){console.error("Error al cargar movimientos:",e),n("Error al cargar los movimientos: ".concat(e.message))}},u=async()=>{try{let e=await (0,x.f2)();l(e),n(null)}catch(e){console.error("Error al cargar art\xedculos:",e),n("Error al cargar los art\xedculos: ".concat(e.message))}};(0,r.useEffect)(()=>{m(),u();let e=setInterval(()=>{m(),u()},1e4);return()=>clearInterval(e)},[]),(0,r.useEffect)(()=>{let e=d.current;if(!e)return;let t=t=>{0!==t.deltaY&&(t.preventDefault(),e.scrollBy({left:t.deltaY<0?-100:100,behavior:"smooth"}))};return e.addEventListener("wheel",t,{passive:!1}),()=>{e.removeEventListener("wheel",t)}},[]);let h=(()=>{switch(c){case N.ENTRADA:case N.SALIDA:case N.CAMBIO_ESTADO:case N.NUEVO_ARTICULO:case N.PRESTAMO:case N.REGRESADO:return e.filter(e=>e.tipo_movimiento===c).slice(0,5);case N.RECENTES:default:return e.slice(0,5)}})(),b=e=>{let t=a.find(t=>t.id===e);return t?t.nombre:"Desconocido"},f=e=>{let t=a.find(t=>t.id===e);if(t)switch(t.estado){case 1:return"Bueno";case 2:return"Malo";case 3:return"De Baja"}return"Desconocido"},p=e=>{switch(e){case"Bueno":return"text-green-500";case"Malo":return"text-red-500";case"De Baja":return"text-yellow-500";default:return"text-gray-500"}},g=e=>k[e]||"text-gray-500",j=e=>w[e]||(0,s.jsx)(y.yk7,{});return o?(0,s.jsx)("p",{className:"text-red-500",children:o}):(0,s.jsxs)("div",{className:"bg-white p-4 md:p-6 rounded-lg shadow h-full relative",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Movimientos"}),(0,s.jsxs)("div",{className:"relative mb-4",children:[(0,s.jsx)("button",{onClick:()=>{d.current&&d.current.scrollBy({left:-150,behavior:"smooth"})},className:"absolute left-0 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-75 hover:bg-opacity-100 text-black rounded-full p-1 shadow focus:outline-none",style:{top:"50%",left:"-15px"},"aria-label":"Desplazar hacia la izquierda",children:(0,s.jsx)(y._Jj,{size:14})}),(0,s.jsx)("div",{className:"flex flex-nowrap overflow-x-auto no-scrollbar cursor-grab",ref:d,children:Object.values(N).map(e=>(0,s.jsxs)("button",{onClick:()=>i(e),className:"flex items-center px-4 py-2 text-sm font-medium whitespace-nowrap transition ".concat(c===e?k[e]?"border-b-2 text-".concat(k[e],"-600 border-").concat(k[e],"-600"):"text-blue-600 border-blue-600":"text-gray-600 hover:text-blue-600"),"aria-label":"Mostrar movimientos de ".concat(e),children:[(0,s.jsx)(v.Vx.Provider,{value:{className:"mr-2"},children:j(e)}),e]},e))}),(0,s.jsx)("button",{onClick:()=>{d.current&&d.current.scrollBy({left:150,behavior:"smooth"})},className:"absolute right-0 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-75 hover:bg-opacity-100 text-black rounded-full p-1 shadow focus:outline-none",style:{top:"50%",right:"-15px"},"aria-label":"Desplazar hacia la derecha",children:(0,s.jsx)(y.X6T,{size:14})})]}),(0,s.jsx)("div",{className:"overflow-y-auto max-h-60 md:max-h-80",children:(0,s.jsx)("ul",{className:"divide-y divide-gray-200",children:h.length>0?h.map((e,t)=>(0,s.jsxs)("li",{className:"flex justify-between items-center py-2",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(v.Vx.Provider,{value:{className:"mr-3 text-".concat(k[e.tipo_movimiento]||"gray","-500")},children:j(e.tipo_movimiento)}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:b(e.articulo)}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"".concat(e.tipo_movimiento," - ").concat(new Date(e.fecha).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}))})]})]}),e.tipo_movimiento===N.CAMBIO_ESTADO?(0,s.jsx)("p",{className:"text-lg font-semibold ".concat(p(f(e.articulo))),children:f(e.articulo)}):(0,s.jsx)("p",{className:"text-lg font-semibold ".concat(g(e.tipo_movimiento)),children:e.cantidad||0})]},e.id||t)):(0,s.jsx)("li",{className:"text-gray-500 text-sm text-center py-4",children:"No hay movimientos en esta categor\xeda."})})})]})}var E=a(44731),D=a(22022),C=a(27762),M=a(27159),Y=a(42774),_=a(39474),A=a(95414);D.t1.register(D.PP,D.kc,D.E8,D.hE,D.m_,D.s$);let P=e=>{let t=(0,C.k)({start:(0,M.k)(new Date,{weekStartsOn:1}),end:(0,Y.f)((0,M.k)(new Date,{weekStartsOn:1}),6)}).filter(e=>{let t=e.getDay();return t>=1&&t<=5}).map(e=>(0,_.GP)(e,"EEEE dd/MM",{locale:A.es})),a=["Entrada","Salida","Nuevo Articulo","Prestamo","Regresado"],s={};a.forEach(e=>{s[e]=t.map(()=>0)}),e.forEach(e=>{if(!a.includes(e.tipo_movimiento))return;let t=new Date(e.fecha),r=(0,M.k)(t,{weekStartsOn:1}),l=(0,C.k)({start:r,end:(0,Y.f)(r,6)}).filter(e=>{let t=e.getDay();return t>=1&&t<=5}).findIndex(e=>(0,_.GP)(e,"yyyy-MM-dd")===(0,_.GP)(t,"yyyy-MM-dd"));-1!==l&&(s[e.tipo_movimiento][l]+=e.cantidad)});let r={Entrada:"rgba(75, 192, 192, 0.7)",Salida:"rgba(255, 99, 132, 0.7)","Nuevo Articulo":"rgba(54, 162, 235, 0.7)",Prestamo:"rgba(153, 102, 255, 0.7)",Regresado:"rgba(255, 159, 64, 0.7)"};return{labels:t,datasets:a.map(e=>({label:e,data:s[e],backgroundColor:r[e]||"rgba(0, 0, 0, 0.7)"}))}};function T(e){let{movimientos:t}=e,a=(0,r.useMemo)(()=>P(t),[t]),l={labels:a.labels,datasets:a.datasets};return(0,s.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-md",style:{height:"500px"},children:(0,s.jsx)(E.yP,{data:l,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},title:{display:!0,text:"Movimientos Diarios (Lunes a Viernes)"},tooltip:{callbacks:{label:e=>{let t=e.dataset.label||"",a=e.parsed.y;return"".concat(t,": ").concat(a)}}}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Cantidad"}},x:{title:{display:!0,text:"D\xeda"}}}}})})}var O=a(95093),R=a.n(O),L=a(59386),B=a.n(L);a(77571);let I=h()(n());var z=a(61756),F=a(11934);function G(e,t,a){let s=R()(e,"YYYY-MM-DD"),r=R()(t,"YYYY-MM-DD"),l=R()(a,"YYYY-MM-DD");return s.isSameOrAfter(r,"day")&&s.isSameOrBefore(l,"day")}function H(e){let{isOpen:t,onClose:a,onSave:l,defaultDay:o}=e,[n,c]=(0,r.useState)(""),[i,d]=(0,r.useState)(""),[m,x]=(0,r.useState)(null),[u,h]=(0,r.useState)(null);return((0,r.useEffect)(()=>{t&&o&&(x(R()(o,"YYYY-MM-DD").toDate()),h(null),c(""),d(""))},[t,o]),t)?(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 px-4",children:(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg w-full max-w-md sm:max-w-lg",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4 text-gray-700",children:o?"Crear Tarea para el D\xeda ".concat(R()(o).format("DD/MM/YYYY")):"Crear Tarea"}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"T\xedtulo"}),(0,s.jsx)("input",{type:"text",className:"w-full border border-gray-300 p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ej: Reuni\xf3n de equipo",value:n,onChange:e=>c(e.target.value)})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Tarea"}),(0,s.jsx)("input",{type:"text",className:"w-full border border-gray-300 p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ej: Reuni\xf3n, Desarrollo, etc.",value:i,onChange:e=>d(e.target.value)})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"Selecciona fecha de inicio y fin (la de inicio ya est\xe1 seleccionada)"}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:space-x-2",children:[(0,s.jsx)(B(),{selected:m,onChange:e=>x(e),selectsStart:!0,startDate:m,endDate:u,dateFormat:"dd/MM/yyyy",className:"w-full border border-gray-300 p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-2 sm:mb-0",placeholderText:"Fecha de Inicio"}),(0,s.jsx)(B(),{selected:u,onChange:e=>h(e),selectsEnd:!0,startDate:m,endDate:u,minDate:m,dateFormat:"dd/MM/yyyy",className:"w-full border border-gray-300 p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholderText:"Fecha de Fin (Opcional)"})]})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,s.jsx)("button",{onClick:a,className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition-colors",children:"Cancelar"}),(0,s.jsx)("button",{onClick:function(){if(!n.trim()){I.fire({icon:"error",title:"Error",text:"Por favor, ingresa un t\xedtulo."});return}if(!m){I.fire({icon:"error",title:"Error",text:"Selecciona al menos la fecha de inicio."});return}let e=u||m;l({title:n.trim(),task_type:i.trim(),start:R()(m).format("YYYY-MM-DD"),end:R()(e).format("YYYY-MM-DD"),completed:!1})},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Guardar"})]})]})}):null}function J(e){let{isOpen:t,onClose:a,tasks:l,clickedDay:o,clickedHoliday:n,onUpdate:c,onDelete:i}=e,d=(0,r.useMemo)(()=>{let e=o||"";return l.filter(t=>o&&G(e,t.start,t.end))},[l,o]);return t?(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 px-4",children:(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg w-full max-w-2xl sm:max-w-xl lg:max-w-2xl overflow-auto",children:[(0,s.jsxs)("h2",{className:"text-xl font-semibold mb-4 text-gray-700",children:["Tareas Pendientes - ",R()(o).format("DD/MM/YYYY")]}),n&&(0,s.jsxs)("div",{className:"mb-4 p-4 bg-red-100 border border-red-400 rounded-md",children:[(0,s.jsxs)("h3",{className:"text-lg font-semibold text-red-700",children:["Feriado: ",n.name]}),(0,s.jsx)("p",{className:"text-sm text-red-600",children:n.description||"Este es un d\xeda feriado oficial."})]}),0!==d.length||n?(0,s.jsx)("ul",{className:"space-y-4",children:d.map(e=>(0,s.jsxs)("li",{className:"flex flex-col sm:flex-row sm:items-center justify-between border-b pb-2",children:[(0,s.jsxs)("div",{className:"mb-2 sm:mb-0",children:[(0,s.jsx)("h3",{className:"text-lg ".concat(e.completed?"line-through text-green-500":"text-gray-800"),children:e.title}),(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:["Tipo de Tarea: ",e.task_type]}),(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:["Fecha: ",R()(e.start).format("DD/MM/YYYY")," ",e.start!==e.end&&" - ".concat(R()(e.end).format("DD/MM/YYYY"))]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("button",{onClick:()=>c(e.id),className:"px-3 py-1 text-sm rounded-md focus:outline-none ".concat(e.completed?"bg-yellow-500 hover:bg-yellow-600 text-white":"bg-green-500 hover:bg-green-600 text-white"),children:e.completed?"Marcar como Incompleta":"Completar"}),(0,s.jsx)("button",{onClick:()=>i(e.id),className:"px-3 py-1 text-sm bg-red-500 hover:bg-red-600 text-white rounded-md focus:outline-none",children:"Eliminar"})]})]},e.id))}):(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"No hay tareas pendientes para este d\xeda."}),(0,s.jsx)("div",{className:"flex justify-end mt-6",children:(0,s.jsx)("button",{onClick:a,className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition-colors",children:"Cerrar"})})]})}):(0,s.jsx)("div",{className:"hidden"})}function V(){let{user:e,loading:t}=(0,F.J)(),[a,l]=(0,r.useState)(!1),[o,n]=(0,r.useState)(!1),[c,i]=(0,r.useState)(null),[d,u]=(0,r.useState)(null),[h,b]=(0,r.useState)([]),[f,p]=(0,r.useState)(R()()),[g,j]=(0,r.useState)([]);(0,r.useEffect)(()=>{R().locale("es")},[]);let y=f.year();(0,r.useEffect)(()=>{let e=new z.A("CL").getHolidays(y);j(e),console.log("Feriados cargados:",e)},[y]);let v=(0,r.useMemo)(()=>e=>{let t=f.clone().date(e).format("YYYY-MM-DD"),a=h.filter(e=>G(t,e.start,e.end)).length;return console.log("D\xeda: ".concat(t,", Tareas: ").concat(a)),a},[h,f]);async function N(e){try{let t=await (0,x.UT)(e);b(e=>[...e,t]),l(!1),I.fire({icon:"success",title:"\xc9xito",text:"Tarea creada correctamente.",timer:2e3,showConfirmButton:!1})}catch(e){console.error("Error al guardar la tarea:",e)}}async function w(e){try{let t=h.find(t=>t.id===e);if(!t)throw Error("Tarea no encontrada");let a=await (0,x.lC)(e,{completed:!t.completed});b(t=>t.map(t=>t.id===e?a:t)),I.fire({icon:"success",title:"\xc9xito",text:"Tarea actualizada correctamente.",timer:2e3,showConfirmButton:!1})}catch(e){console.error("Error al actualizar tarea:",e),I.fire({icon:"error",title:"Error",text:"No se pudo actualizar la tarea. Por favor, int\xe9ntalo de nuevo."})}}async function k(e){try{await (0,x.vq)(e)&&(b(t=>t.filter(t=>t.id!==e)),I.fire({icon:"success",title:"Eliminado",text:"La tarea ha sido eliminada.",timer:2e3,showConfirmButton:!1}))}catch(e){console.error("Error al eliminar tarea:",e),I.fire({icon:"error",title:"Error",text:"No se pudo eliminar la tarea. Por favor, int\xe9ntalo de nuevo."})}}(0,r.useEffect)(()=>{e&&e.id?(0,x.j)(e.id).then(e=>{b(e),console.log("Tareas cargadas desde el backend:",e)}).catch(e=>{console.error("Error al cargar tareas:",e)}):b([])},[e]);let S=(f.clone().startOf("month").day()+6)%7,E=f.daysInMonth(),D=function(e){let t=[];for(let a=0;a<e;a++)t.push((0,s.jsx)("div",{className:"hidden sm:block"},"empty-".concat(a)));return t}(S),C=function(e){let t=[];for(let a=1;a<=e;a++){let e=v(a),r=f.clone().date(a),l=r.format("YYYY-MM-DD"),o=g.find(e=>e.date===l),c=!!o,d=o?o.name:"",m=0===r.day();t.push((0,s.jsxs)("div",{className:"p-2 border border-gray-200 text-center relative cursor-pointer hover:bg-gray-100 rounded-lg h-24 flex flex-col justify-between ".concat(c?"bg-red-100 text-red-700":m?"text-red-500":"bg-white text-gray-800"),onClick:()=>{i(l),u(c?o:null),n(!0)},title:c?d:void 0,children:[(0,s.jsx)("div",{className:"font-semibold",children:a}),(0,s.jsxs)("div",{className:"flex items-center justify-center space-x-1",children:[e>0&&(0,s.jsx)("span",{className:"bg-blue-500 text-white text-xs px-2 py-0.5 rounded-full",title:"Hay ".concat(e," tarea(s)"),children:e}),c&&(0,s.jsx)("span",{className:"w-3 h-3 bg-red-500 rounded-full",title:"Feriado: ".concat(d)})]})]},a))}return t}(E);return t?(0,s.jsx)("div",{children:"Cargando..."}):e?(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4 space-y-4 sm:space-y-0",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("button",{onClick:function(){p(f.clone().subtract(1,"months"))},className:"p-2 bg-blue-500 text-white rounded-full hover:bg-blue-600 transition-colors focus:outline-none",title:"Mes Anterior",children:(0,s.jsx)(m.kRp,{})}),(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-700",children:f.format("MMMM YYYY")}),(0,s.jsx)("button",{onClick:function(){p(f.clone().add(1,"months"))},className:"p-2 bg-blue-500 text-white rounded-full hover:bg-blue-600 transition-colors focus:outline-none",title:"Mes Siguiente",children:(0,s.jsx)(m.dyV,{})})]}),(0,s.jsxs)("button",{onClick:()=>{i(R()().format("YYYY-MM-DD")),u(null),l(!0)},className:"flex items-center bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition-colors focus:outline-none",children:[(0,s.jsx)(m.GGD,{className:"mr-2"}),"A\xf1adir Tarea"]})]}),(0,s.jsx)("div",{className:"grid grid-cols-7 gap-1 mb-2",children:["Lun","Mar","Mi\xe9","Jue","Vie","S\xe1b","Dom"].map((e,t)=>(0,s.jsx)("div",{className:"font-bold text-center bg-gray-200 p-2 rounded-md text-sm",children:e},t))}),(0,s.jsxs)("div",{className:"grid grid-cols-7 gap-1",children:[D,C]}),(0,s.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:'*Haz clic en un d\xeda para ver las tareas pendientes o usa el bot\xf3n "A\xf1adir Tarea" para agregar una tarea para hoy.'}),(0,s.jsx)(H,{isOpen:a,onClose:()=>l(!1),onSave:N,defaultDay:c}),(0,s.jsx)(J,{isOpen:o,onClose:()=>n(!1),tasks:h,clickedDay:c,clickedHoliday:d,onUpdate:w,onDelete:k})]}):(0,s.jsx)("div",{children:"No est\xe1s autenticado. Por favor, inicia sesi\xf3n."})}function q(){let[e,t]=(0,r.useState)([]),[a,o]=(0,r.useState)([]),[i,d]=(0,r.useState)(!0),[u,h]=(0,r.useState)(!1),[b,f]=(0,r.useState)(null),p=(0,l.useRouter)(),g=(0,r.useCallback)(async()=>{try{let[e,a]=await Promise.all([(0,x.f2)(),(0,x.J3)()]);t(e),o(a);let s=e.filter(e=>e.stock_actual<e.stock_minimo).length;s>0&&!u&&(h(!0),n().fire({icon:"warning",title:"Stock bajo",text:"Tienes ".concat(s," producto(s) con stock por debajo del m\xednimo"),confirmButtonText:"Entendido"}))}catch(e){console.error("Error al cargar datos:",e),n().fire({icon:"error",title:"Error",text:"Error al cargar los datos del dashboard."})}finally{d(!1)}},[u]);return(0,r.useEffect)(()=>{if(!localStorage.getItem("access_token")){p.replace("/login");return}let e=localStorage.getItem("user");e&&f(JSON.parse(e)),g()},[p,g]),(0,s.jsxs)("div",{className:"flex min-h-screen bg-gray-100",children:[(0,s.jsx)(c.A,{}),(0,s.jsxs)("main",{className:"flex-1 p-6 sm:ml-64",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[b&&(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(m.JXP,{className:"text-2xl text-blue-600"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h1",{className:"text-2xl font-bold text-gray-800",children:["\xa1Hola, ",b.username,"!"]}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Bienvenido a tu panel de control."})]})]}),(0,s.jsxs)("button",{onClick:()=>{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user"),n().fire({icon:"success",title:"Sesi\xf3n cerrada",text:"Has cerrado sesi\xf3n correctamente."}).then(()=>{p.replace("/login")})},className:"flex items-center bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition-colors",children:[(0,s.jsx)(m.QeK,{className:"mr-2"}),"Cerrar Sesi\xf3n"]})]}),(0,s.jsx)(j,{}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6",children:[(0,s.jsxs)("section",{className:"bg-white p-6 rounded-lg shadow hover:shadow-lg transition-shadow",children:[(0,s.jsxs)("div",{className:"flex items-center mb-4",children:[(0,s.jsx)(m.y3G,{className:"text-2xl text-blue-500 mr-2"}),(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-700",children:"Entradas, Salidas, Pr\xe9stamos, etc. (Semana)"})]}),(0,s.jsx)(T,{movimientos:a})]}),(0,s.jsx)(S,{})]}),(0,s.jsx)("div",{className:"mt-6",children:(0,s.jsx)(V,{})})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[563,673,465,90,637,197,833,615,356,23,312,194,132,365,636,593,792],()=>t(30206)),_N_E=e.O()}]);