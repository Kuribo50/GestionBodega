(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[305],{16278:(e,t,o)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/stock/salida",function(){return o(26452)}])},26452:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>d});var a=o(74848),i=o(96540),r=o(78465),n=o.n(r),l=o(96365),s=o(46005),c=o(56598);function d(){var e,t,o,r;let[d,u]=(0,i.useState)({nombre:"",articulo_id:"",categoria:"",cantidad:"",modelo:"",marca:"",numero_serie:"",codigo_minvu:"",codigo_interno:"",mac:"",descripcion:"",ubicacion:"",motivo:""}),[m,b]=(0,i.useState)([]),[g,f]=(0,i.useState)([]),[p,h]=(0,i.useState)([]),[x,v]=(0,i.useState)([]),[y,w]=(0,i.useState)([]),[N,j]=(0,i.useState)([]),[C,S]=(0,i.useState)(!1),[_,k]=(0,i.useState)(!0),[A,O]=(0,i.useState)(null),[B,L]=(0,i.useState)(!1);(0,i.useEffect)(()=>{E()},[]);let E=async()=>{try{k(!0);let e=localStorage.getItem("access_token"),[t,o,a,i,r,n]=await Promise.all([fetch("http://localhost:8000/api/categorias/",{headers:{Authorization:"Bearer ".concat(e)}}),fetch("http://localhost:8000/api/marcas/",{headers:{Authorization:"Bearer ".concat(e)}}),fetch("http://localhost:8000/api/modelos/",{headers:{Authorization:"Bearer ".concat(e)}}),fetch("http://localhost:8000/api/ubicaciones/",{headers:{Authorization:"Bearer ".concat(e)}}),fetch("http://localhost:8000/api/articulos/",{headers:{Authorization:"Bearer ".concat(e)}}),fetch("http://localhost:8000/api/motivos/",{headers:{Authorization:"Bearer ".concat(e)}})]),[l,s,c,d,u,m]=await Promise.all([t.json(),o.json(),a.json(),i.json(),r.json(),n.json()]);b(l),f(s),h(c),v(d),w(u.map(e=>({value:e.id,nombre:e.nombre,stock:e.stock_actual,codes:[{label:"C\xf3digo MINVU",value:e.codigo_minvu||"N/A"},{label:"C\xf3digo Interno",value:e.codigo_interno||"N/A"},{label:"N\xfamero de Serie",value:e.numero_serie||"N/A"},{label:"MAC",value:e.mac||"N/A"}].filter(e=>"N/A"!==e.value),categoria:e.categoria,marca:e.marca,modelo:e.modelo,ubicacion:e.ubicacion,descripcion:e.descripcion}))),j(m.map(e=>({label:e.nombre,value:e.id})))}catch(e){console.error("Error al cargar los datos de la API:",e),n().fire({icon:"error",title:"Error",text:"Error al cargar los datos de la API.",position:"center",buttonsStyling:!1,customClass:{confirmButton:"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded"}})}finally{k(!1)}},I=async e=>{if(e){if(e.__isNew__)try{let t=localStorage.getItem("access_token"),o=await fetch("http://localhost:8000/api/motivos/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({nombre:e.label})});if(!o.ok){let e=await o.json();n().fire({icon:"error",title:"Error",text:"Error al crear el motivo: ".concat(JSON.stringify(e)),position:"center",buttonsStyling:!1,customClass:{confirmButton:"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded"}});return}let a=await o.json();j(e=>[...e,{label:a.nombre,value:a.id}]),u(e=>({...e,motivo:a.id})),n().fire({icon:"success",title:"\xa1\xc9xito!",text:"Motivo creado correctamente.",timer:1500,showConfirmButton:!1,toast:!0,position:"center"})}catch(e){console.error("Error al crear el motivo:",e),n().fire({icon:"error",title:"Error",text:"Hubo un problema al crear el motivo.",position:"center",buttonsStyling:!1,customClass:{confirmButton:"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded"}})}else u(t=>({...t,motivo:e.value}))}else u(e=>({...e,motivo:""}))},M=()=>d.nombre&&d.cantidad?!(parseInt(d.cantidad,10)>A)||(n().fire({icon:"warning",title:"Cantidad inv\xe1lida",text:"La cantidad excede el stock actual.",position:"center",buttonsStyling:!1,customClass:{confirmButton:"bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded"}}),!1):(n().fire({icon:"warning",title:"Campos requeridos",text:"Todos los campos son obligatorios.",position:"center",buttonsStyling:!1,customClass:{confirmButton:"bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded"}}),!1),P=async e=>{if(e.preventDefault(),S(!0),!M()){S(!1);return}try{let e=localStorage.getItem("access_token"),t=parseInt(d.cantidad,10),o=d.motivo;if(!o){let t=N.find(e=>"salida de stock"===e.label.toLowerCase());if(t)o=t.value;else{let t=await fetch("http://localhost:8000/api/motivos/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({nombre:"Salida de Stock"})});if(t.ok){let e=await t.json();j(t=>[...t,{label:e.nombre,value:e.id}]),o=e.id}else{let e=await t.json();n().fire({icon:"error",title:"Error",text:"Error al crear el motivo por defecto: ".concat(JSON.stringify(e)),position:"center",buttonsStyling:!1,customClass:{confirmButton:"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded"}}),S(!1);return}}}let a={articulo:d.articulo_id,tipo_movimiento:"Salida",cantidad:t,fecha:new Date().toISOString(),ubicacion:d.ubicacion,comentario:"Salida de stock",motivo:o},i=await fetch("http://localhost:8000/api/movimientos/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(a)});if(i.ok)n().fire({icon:"success",title:"\xa1\xc9xito!",text:"Salida de stock registrada correctamente.",timer:1500,showConfirmButton:!1,position:"center",buttonsStyling:!1,customClass:{confirmButton:"bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded"}}),O(e=>e-t),T();else{let e=await i.json();n().fire({icon:"error",title:"Error",text:"Error al registrar la salida de stock: ".concat(JSON.stringify(e)),position:"center",buttonsStyling:!1,customClass:{confirmButton:"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded"}})}}catch(e){console.error("Error al registrar la salida de stock:",e),n().fire({icon:"error",title:"Error",text:"Hubo un problema al comunicarse con el servidor.",position:"center",buttonsStyling:!1,customClass:{confirmButton:"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded"}})}finally{S(!1)}},T=()=>{u({nombre:"",articulo_id:"",categoria:"",cantidad:"",modelo:"",marca:"",numero_serie:"",codigo_minvu:"",codigo_interno:"",mac:"",descripcion:"",ubicacion:"",motivo:""}),O(null),L(!1)};return(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)(l.A,{}),(0,a.jsxs)("main",{className:"flex-1 p-6 sm:ml-64 bg-gray-100",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Salida de art\xedculos"}),(0,a.jsxs)("form",{onSubmit:P,className:"bg-white p-6 rounded-lg shadow mb-6 space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre"}),(0,a.jsx)(s.Ay,{options:y,onChange:e=>{if(e){let r=y.find(t=>t.value===e.value);if(r){var t,o,a,i;u({...d,nombre:r.nombre,articulo_id:r.value,categoria:r.categoria,marca:r.marca,modelo:r.modelo,ubicacion:r.ubicacion,numero_serie:(null===(t=r.codes.find(e=>"N\xfamero de Serie"===e.label))||void 0===t?void 0:t.value)||"",codigo_minvu:(null===(o=r.codes.find(e=>"C\xf3digo MINVU"===e.label))||void 0===o?void 0:o.value)||"",codigo_interno:(null===(a=r.codes.find(e=>"C\xf3digo Interno"===e.label))||void 0===a?void 0:a.value)||"",mac:(null===(i=r.codes.find(e=>"MAC"===e.label))||void 0===i?void 0:i.value)||"",descripcion:r.descripcion||""}),O(r.stock||0),L(!0)}}else T()},className:"w-full",placeholder:"Seleccionar Producto",isLoading:_,value:d.articulo_id&&y.find(e=>e.value===d.articulo_id)||null,isDisabled:C,formatOptionLabel:e=>(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"font-semibold",children:e.nombre}),e.codes.length>0&&(0,a.jsx)("span",{className:"text-sm text-gray-500",children:e.codes.map((t,o)=>(0,a.jsxs)("span",{children:[t.label,": ",t.value,o<e.codes.length-1&&" | "]},o))}),(0,a.jsxs)("span",{className:"text-xs text-gray-400",children:["Stock: ",e.stock]})]}),filterOption:(e,t)=>e.data.nombre.toLowerCase().includes(t.toLowerCase())})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Categor\xeda"}),(0,a.jsx)("input",{type:"text",value:d.categoria&&(null===(e=m.find(e=>e.id===d.categoria))||void 0===e?void 0:e.nombre)||"",disabled:!0,className:"w-full border-gray-300 rounded-lg bg-gray-100"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cantidad"}),(0,a.jsx)("input",{type:"number",name:"cantidad",value:d.cantidad,onChange:e=>u({...d,[e.target.name]:e.target.value}),className:"w-full border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500",min:"1",disabled:C,required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Stock Actual"}),(0,a.jsx)("input",{type:"text",value:null!==A?A:"Sin informaci\xf3n",disabled:!0,className:"w-full border-gray-300 rounded-lg bg-gray-100"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Modelo"}),(0,a.jsx)("input",{type:"text",value:d.modelo&&(null===(t=p.find(e=>e.id===d.modelo))||void 0===t?void 0:t.nombre)||"",disabled:!0,className:"w-full border-gray-300 rounded-lg bg-gray-100"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Marca"}),(0,a.jsx)("input",{type:"text",value:d.marca&&(null===(o=g.find(e=>e.id===d.marca))||void 0===o?void 0:o.nombre)||"",disabled:!0,className:"w-full border-gray-300 rounded-lg bg-gray-100"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ubicaci\xf3n"}),(0,a.jsx)("input",{type:"text",value:d.ubicacion&&(null===(r=x.find(e=>e.id===d.ubicacion))||void 0===r?void 0:r.nombre)||"",disabled:!0,className:"w-full border-gray-300 rounded-lg bg-gray-100"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"N\xfamero de Serie"}),(0,a.jsx)("input",{type:"text",value:d.numero_serie||"",disabled:!0,className:"w-full border-gray-300 rounded-lg bg-gray-100"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"MAC Address"}),(0,a.jsx)("input",{type:"text",value:d.mac||"",disabled:!0,className:"w-full border-gray-300 rounded-lg bg-gray-100"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"C\xf3digo Interno"}),(0,a.jsx)("input",{type:"text",value:d.codigo_interno||"",disabled:!0,className:"w-full border-gray-300 rounded-lg bg-gray-100"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"C\xf3digo MINVU"}),(0,a.jsx)("input",{type:"text",value:d.codigo_minvu||"",disabled:!0,className:"w-full border-gray-300 rounded-lg bg-gray-100"})]}),(0,a.jsxs)("div",{className:"sm:col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripci\xf3n"}),(0,a.jsx)("textarea",{value:d.descripcion||"",disabled:!0,className:"w-full border-gray-300 rounded-lg bg-gray-100",rows:"2"})]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Motivo"}),(0,a.jsx)(c.A,{name:"motivo",options:N,onChange:I,className:"w-full",isClearable:!0,placeholder:"Seleccionar o Crear Motivo",isLoading:_,formatCreateLabel:e=>'Crear "'.concat(e,'"'),value:d.motivo&&N.find(e=>e.value===d.motivo)||null,isDisabled:C})]}),(0,a.jsxs)("div",{className:"flex justify-end mt-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{n().fire({title:"\xbfCancelar salida?",text:"Todos los datos ingresados se perder\xe1n.",icon:"warning",showCancelButton:!0,confirmButtonText:"S\xed, cancelar",confirmButtonColor:"#d33",cancelButtonText:"No, continuar",cancelButtonColor:"#3085d6",position:"center",buttonsStyling:!1,customClass:{confirmButton:"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded",cancelButton:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"}}).then(e=>{e.isConfirmed&&(T(),n().fire({icon:"success",title:"Cancelado",text:"La salida fue cancelada.",position:"center",buttonsStyling:!1,customClass:{confirmButton:"bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded"}}))})},className:"mr-4 px-4 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400 transition-colors duration-200",children:"Cancelar"}),(0,a.jsx)("button",{type:"submit",disabled:C,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors duration-200 ".concat(C?"bg-blue-300 cursor-not-allowed":""),children:C?"Registrando...":"Registrar Salida"})]})]})]})]})}},56598:(e,t,o)=>{"use strict";o.d(t,{A:()=>g});var a=o(58168),i=o(96540),r=o(107),n=o(52836),l=o(89379),s=o(64241),c=o(82305),d=o(49164),u=["allowCreateWhileLoading","createOptionPosition","formatCreateLabel","isValidNewOption","getNewOptionData","onCreateOption","options","onChange"],m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0,a=String(e).toLowerCase(),i=String(o.getOptionValue(t)).toLowerCase(),r=String(o.getOptionLabel(t)).toLowerCase();return i===a||r===a},b={formatCreateLabel:function(e){return'Create "'.concat(e,'"')},isValidNewOption:function(e,t,o,a){return!(!e||t.some(function(t){return m(e,t,a)})||o.some(function(t){return m(e,t,a)}))},getNewOptionData:function(e,t){return{label:t,value:e,__isNew__:!0}}};o(40961),o(27003);var g=(0,i.forwardRef)(function(e,t){var o,m,g,f,p,h,x,v,y,w,N,j,C,S,_,k,A,O,B,L,E,I,M,P,T,V,D,z,J=(g=void 0!==(m=(o=(0,n.u)(e)).allowCreateWhileLoading)&&m,p=void 0===(f=o.createOptionPosition)?"last":f,x=void 0===(h=o.formatCreateLabel)?b.formatCreateLabel:h,y=void 0===(v=o.isValidNewOption)?b.isValidNewOption:v,N=void 0===(w=o.getNewOptionData)?b.getNewOptionData:w,j=o.onCreateOption,S=void 0===(C=o.options)?[]:C,_=o.onChange,O=void 0===(A=(k=(0,c.A)(o,u)).getOptionValue)?r.g:A,L=void 0===(B=k.getOptionLabel)?r.b:B,E=k.inputValue,I=k.isLoading,M=k.isMulti,P=k.value,T=k.name,V=(0,i.useMemo)(function(){return y(E,(0,d.H)(P),S,{getOptionValue:O,getOptionLabel:L})?N(E,x(E)):void 0},[x,N,L,O,E,y,S,P]),D=(0,i.useMemo)(function(){return(g||!I)&&V?"first"===p?[V].concat((0,s.A)(S)):[].concat((0,s.A)(S),[V]):S},[g,p,I,V,S]),z=(0,i.useCallback)(function(e,t){if("select-option"!==t.action)return _(e,t);var o=Array.isArray(e)?e:[e];if(o[o.length-1]===V){if(j)j(E);else{var a=N(E,E);_((0,d.D)(M,[].concat((0,s.A)((0,d.H)(P)),[a]),a),{action:"create-option",name:T,option:a})}return}_(e,t)},[N,E,M,T,V,j,_,P]),(0,l.A)((0,l.A)({},k),{},{options:D,onChange:z}));return i.createElement(r.S,(0,a.A)({ref:t},J))})},46005:(e,t,o)=>{"use strict";o.d(t,{Ay:()=>l});var a=o(52836),i=o(58168),r=o(96540),n=o(107);o(95852),o(40961),o(27003);var l=(0,r.forwardRef)(function(e,t){var o=(0,a.u)(e);return r.createElement(n.S,(0,i.A)({ref:t},o))})}},e=>{var t=t=>e(e.s=t);e.O(0,[563,615,356,23,706,365,636,593,792],()=>t(16278)),_N_E=e.O()}]);