(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[511],{12480:(e,o,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/stock/cambio-estado",function(){return a(70066)}])},70066:(e,o,a)=>{"use strict";a.r(o),a.d(o,{default:()=>m});var t=a(74848),i=a(96540),r=a(78465),n=a.n(r),s=a(96365),l=a(46005),c=a(56598);let d=e=>"Bueno"===e?"text-green-600 font-bold":"Malo"===e?"text-red-600 font-bold":"En reparaci\xf3n"===e?"text-orange-600 font-bold":"De baja"===e?"text-red-600 font-bold":"text-gray-600 font-bold";function m(){let[e,o]=(0,i.useState)({articulo_id:"",estado_id:"",motivo_id:"",cantidad_transferir:"1"}),[a,r]=(0,i.useState)("Cambio de Estado"),[m,u]=(0,i.useState)([]),[b,h]=(0,i.useState)([]),[p,g]=(0,i.useState)([]),[v,f]=(0,i.useState)([]),[_,x]=(0,i.useState)([]),[N,C]=(0,i.useState)([]),[A,j]=(0,i.useState)([]),[w,y]=(0,i.useState)([]),[k,E]=(0,i.useState)(!0),[S,O]=(0,i.useState)(null),[L,B]=(0,i.useState)({categoria:"N/A",marca:"N/A",modelo:"N/A",ubicacion:"N/A",estado:"N/A",nombre:"N/A",stock_minimo:"N/A",stock_actual:"N/A",descripcion:"N/A",codigo_interno:"N/A",codigo_minvu:"N/A",numero_serie:"N/A",mac:"N/A"}),M=(0,i.useCallback)(async e=>{let o=await fetch("http://localhost:8000/api/categorias/",{headers:{Authorization:"Bearer ".concat(e)}});return(await o.json()).sort((e,o)=>e.nombre.localeCompare(o.nombre)).map(e=>({label:e.nombre,value:e.id}))},[]),D=(0,i.useCallback)(async e=>{let o=await fetch("http://localhost:8000/api/marcas/",{headers:{Authorization:"Bearer ".concat(e)}});return(await o.json()).sort((e,o)=>e.nombre.localeCompare(o.nombre)).map(e=>({label:e.nombre,value:e.id}))},[]),I=(0,i.useCallback)(async e=>{let o=await fetch("http://localhost:8000/api/modelos/",{headers:{Authorization:"Bearer ".concat(e)}});return(await o.json()).sort((e,o)=>e.nombre.localeCompare(o.nombre)).map(e=>({label:e.nombre,value:e.id}))},[]),z=(0,i.useCallback)(async e=>{let o=await fetch("http://localhost:8000/api/ubicaciones/",{headers:{Authorization:"Bearer ".concat(e)}});return(await o.json()).sort((e,o)=>e.nombre.localeCompare(o.nombre)).map(e=>({label:e.nombre,value:e.id}))},[]),P=(0,i.useCallback)(async e=>{let o=await fetch("http://localhost:8000/api/articulos/",{headers:{Authorization:"Bearer ".concat(e)}});return(await o.json()).sort((e,o)=>e.nombre.localeCompare(o.nombre)).map(e=>({nombre:e.nombre,value:e.id,categoria_id:e.categoria,marca_id:e.marca,modelo_id:e.modelo,ubicacion_id:e.ubicacion,estado_id:e.estado,stock_minimo:e.stock_minimo,stock_actual:e.stock_actual,descripcion:e.descripcion,codigo_interno:e.codigo_interno,codigo_minvu:e.codigo_minvu,numero_serie:e.numero_serie,mac:e.mac,codes:[{label:"C\xf3digo MINVU",value:e.codigo_minvu||"N/A"},{label:"C\xf3digo Interno",value:e.codigo_interno||"N/A"},{label:"N\xfamero de Serie",value:e.numero_serie||"N/A"},{label:"MAC Address",value:e.mac||"N/A"}].filter(e=>"N/A"!==e.value)}))},[]),T=(0,i.useCallback)(async e=>{let o=await fetch("http://localhost:8000/api/estados/",{headers:{Authorization:"Bearer ".concat(e)}});return(await o.json()).sort((e,o)=>e.nombre.localeCompare(o.nombre)).map(e=>({label:e.nombre,value:e.id}))},[]),U=(0,i.useCallback)(async e=>{let o=await fetch("http://localhost:8000/api/motivos/",{headers:{Authorization:"Bearer ".concat(e)}});return(await o.json()).sort((e,o)=>e.nombre.localeCompare(o.nombre)).map(e=>({label:e.nombre,value:e.id}))},[]),V=(0,i.useCallback)(async()=>{try{E(!0);let e=localStorage.getItem("access_token"),[o,a,t,i,r,n,s,l]=await Promise.all([M(e),D(e),I(e),z(e),P(e),T(e),U(e),fetch("http://localhost:8000/api/historial-stock/",{headers:{Authorization:"Bearer ".concat(e)}}).then(e=>e.json())]);u(o),h(a),g(t),f(i),x(r),C(n),j(s),y(l),console.log("Art\xedculos:",r)}catch(e){n().fire({icon:"error",title:"Error",text:"Error al cargar los datos de la API.",position:"center",confirmButtonColor:"#2563EB",customClass:{confirmButton:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"}})}finally{E(!1)}},[M,D,I,z,P,T,U]);(0,i.useEffect)(()=>{V()},[V]);let F=(e,o)=>{let a=o.find(o=>o.value===e);return a?a.label:"N/A"},J=async a=>{let t=localStorage.getItem("access_token");try{let i=await fetch("http://localhost:8000/api/estados/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({nombre:a})});if(!i.ok){let e=await i.json();throw Error(e.detail||"Error al crear el nuevo estado.")}let r=await i.json(),s={label:r.nombre,value:r.id};C(e=>[...e,s]),o({...e,estado_id:r.id}),n().fire({icon:"success",title:"\xc9xito",text:'Estado "'.concat(r.nombre,'" creado correctamente.'),position:"center",confirmButtonColor:"#2563EB",customClass:{confirmButton:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"}})}catch(e){n().fire({icon:"error",title:"Error",text:e.message||"No se pudo crear el estado.",position:"center",confirmButtonColor:"#DC2626",customClass:{confirmButton:"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded"}})}},R=async a=>{let t=localStorage.getItem("access_token");try{let i=await fetch("http://localhost:8000/api/motivos/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({nombre:a})});if(!i.ok){let e=await i.json();throw Error(e.detail||"Error al crear el nuevo motivo.")}let r=await i.json(),s={label:r.nombre,value:r.id};j(e=>[...e,s]),o({...e,motivo_id:r.id}),n().fire({icon:"success",title:"\xc9xito",text:'Motivo "'.concat(r.nombre,'" creado correctamente.'),position:"center",confirmButtonColor:"#2563EB",customClass:{confirmButton:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"}})}catch(e){n().fire({icon:"error",title:"Error",text:e.message||"No se pudo crear el motivo.",position:"center",confirmButtonColor:"#DC2626",customClass:{confirmButton:"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded"}})}},H=(e,o,a)=>{let t="bg-blue-600 hover:bg-blue-700";"error"===e?t="bg-red-600 hover:bg-red-700":"warning"===e?t="bg-yellow-500 hover:bg-yellow-600":"info"===e?t="bg-blue-600 hover:bg-blue-700":"success"===e&&(t="bg-green-600 hover:bg-green-700"),n().fire({icon:e,title:o,text:a,position:"center",buttonsStyling:!1,customClass:{confirmButton:"".concat(t," text-white font-bold py-2 px-4 rounded")}})},W=async t=>{if(t.preventDefault(),!e.articulo_id||!e.estado_id||!e.motivo_id){H("warning","Campos incompletos","Debes seleccionar un art\xedculo, un estado y un motivo.");return}_.find(o=>o.value===e.articulo_id);let i=localStorage.getItem("access_token");if(!i){H("error","Error","No se encontr\xf3 el token de autenticaci\xf3n.");return}let n={articulo:e.articulo_id,tipo_movimiento:a,comentario:"Cambio de Estado"===a?'Cambio de estado a "'.concat(F(e.estado_id,N),'" por motivo "').concat(F(e.motivo_id,A),'"'):'Cambio de estado por unidad a "'.concat(F(e.estado_id,N),'" por motivo "').concat(F(e.motivo_id,A),'"'),estado_nuevo:e.estado_id,motivo:e.motivo_id};if("Cambio de Estado por Unidad"===a&&(n.cantidad=parseInt(e.cantidad_transferir,10)),"Cambio de Estado por Unidad"===a){let o=parseInt(e.cantidad_transferir,10);if(isNaN(o)||o<=0){H("warning","Cantidad Inv\xe1lida","La cantidad a transferir debe ser un n\xfamero v\xe1lido mayor a cero.");return}if(o>L.stock_actual&&o>0){H("warning","Stock Insuficiente","La cantidad a transferir (".concat(o,") excede el stock actual (").concat(L.stock_actual,")."));return}}console.log("Payload enviado al backend:",n);try{let t=await fetch("http://localhost:8000/api/movimientos/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(i)},body:JSON.stringify(n)});if(t.ok){if(H("success","\xc9xito","Movimiento registrado correctamente."),await t.json(),"Cambio de Estado"===a){x(o=>o.map(o=>o.value===e.articulo_id?{...o,estado_id:e.estado_id}:o));let o=F(e.estado_id,N);B(e=>({...e,estado:o}))}if("Cambio de Estado por Unidad"===a){let o=parseInt(e.cantidad_transferir,10);B(e=>({...e,stock_actual:"N/A"!==e.stock_actual?e.stock_actual-o:e.stock_actual}))}o({articulo_id:"",estado_id:"",motivo_id:"",cantidad_transferir:"1"}),O(null),r("Cambio de Estado"),setTimeout(()=>{B({categoria:"N/A",marca:"N/A",modelo:"N/A",ubicacion:"N/A",estado:"N/A",nombre:"N/A",stock_minimo:"N/A",stock_actual:"N/A",descripcion:"N/A",codigo_interno:"N/A",codigo_minvu:"N/A",numero_serie:"N/A",mac:"N/A"})},5e3)}else{let e=await t.json();H("error","Error al registrar el movimiento",e.detail||"No se pudo registrar el movimiento."),console.error("Error al registrar el movimiento:",e)}}catch(e){H("error","Error","Error al comunicarse con el servidor."),console.error("Error al comunicarse con el servidor:",e)}};return(0,t.jsxs)("div",{className:"flex bg-gray-100 min-h-screen",children:[(0,t.jsx)(s.A,{}),(0,t.jsxs)("main",{className:"flex-1 p-6 sm:ml-64",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Gesti\xf3n de Movimientos de Art\xedculo"}),(0,t.jsxs)("form",{onSubmit:W,className:"bg-white p-6 rounded-lg shadow mb-6 space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de Movimiento"}),(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsxs)("label",{className:"flex items-center",children:[(0,t.jsx)("input",{type:"radio",name:"tipoMovimiento",value:"Cambio de Estado",checked:"Cambio de Estado"===a,onChange:e=>r(e.target.value),className:"h-4 w-4 text-blue-600 border-gray-300 rounded"}),(0,t.jsx)("span",{className:"ml-2",children:"Cambio de Estado"})]}),(0,t.jsxs)("label",{className:"flex items-center",children:[(0,t.jsx)("input",{type:"radio",name:"tipoMovimiento",value:"Cambio de Estado por Unidad",checked:"Cambio de Estado por Unidad"===a,onChange:e=>r(e.target.value),className:"h-4 w-4 text-purple-600 border-gray-300 rounded"}),(0,t.jsx)("span",{className:"ml-2",children:"Cambio de Estado por Unidad"})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"articulo",className:"block text-sm font-medium text-gray-700",children:"Art\xedculo"}),(0,t.jsx)(l.Ay,{id:"articulo",value:_.find(e=>e.value===S)||null,options:_,onChange:a=>{if(a){O(a.value),o({...e,articulo_id:a.value,estado_id:"",motivo_id:""});let t=_.find(e=>e.value===a.value);if(t){let e=N.find(e=>e.value===t.estado_id);B({categoria:F(t.categoria_id,m),marca:F(t.marca_id,b),modelo:F(t.modelo_id,p),ubicacion:F(t.ubicacion_id,v),estado:e?e.label:"N/A",nombre:t.nombre||"N/A",stock_minimo:null!==t.stock_minimo?t.stock_minimo:"N/A",stock_actual:null!==t.stock_actual?t.stock_actual:"N/A",descripcion:t.descripcion||"N/A",codigo_interno:t.codigo_interno||"N/A",codigo_minvu:t.codigo_minvu||"N/A",numero_serie:t.numero_serie||"N/A",mac:t.mac||"N/A"})}}else O(null),o({...e,articulo_id:"",estado_id:"",motivo_id:"",cantidad_transferir:"1"}),B({categoria:"N/A",marca:"N/A",modelo:"N/A",ubicacion:"N/A",estado:"N/A",nombre:"N/A",stock_minimo:"N/A",stock_actual:"N/A",descripcion:"N/A",codigo_interno:"N/A",codigo_minvu:"N/A",numero_serie:"N/A",mac:"N/A"})},className:"mt-2",placeholder:k?"Cargando art\xedculos...":"Seleccione un art\xedculo",isDisabled:k||0===_.length,noOptionsMessage:()=>"No hay art\xedculos disponibles",formatOptionLabel:e=>{let o=N.find(o=>o.value===e.estado_id);return(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"font-semibold",children:e.nombre}),e.codes&&e.codes.length>0&&(0,t.jsx)("span",{className:"text-sm text-gray-500",children:e.codes.map((o,a)=>(0,t.jsxs)("span",{children:[o.label,": ",o.value,a<e.codes.length-1&&" | "]},a))}),(0,t.jsx)("span",{className:"".concat(d(null==o?void 0:o.label)),children:o?o.label:"N/A"})]})},filterOption:(e,o)=>{let a=e.data.nombre.toLowerCase(),t=e.data.codigo_minvu?e.data.codigo_minvu.toLowerCase():"",i=e.data.codigo_interno?e.data.codigo_interno.toLowerCase():"",r=e.data.numero_serie?e.data.numero_serie.toLowerCase():"",n=e.data.mac?e.data.mac.toLowerCase():"";return a.includes(o.toLowerCase())||t.includes(o.toLowerCase())||i.includes(o.toLowerCase())||r.includes(o.toLowerCase())||n.includes(o.toLowerCase())}})]}),("Cambio de Estado"===a||"Cambio de Estado por Unidad"===a)&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"estado",className:"block text-sm font-medium text-gray-700",children:"Nuevo Estado"}),(0,t.jsx)(c.A,{id:"estado",value:N.find(o=>o.value===e.estado_id)||null,options:N,onChange:a=>{o({...e,estado_id:a?a.value:""})},onCreateOption:J,className:"mt-2",placeholder:k?"Cargando estados...":"Seleccione o cree un estado",isDisabled:k||0===N.length,noOptionsMessage:()=>"No hay estados disponibles",formatOptionLabel:e=>(0,t.jsx)("span",{className:"".concat(d(e.label)),children:e.label})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"motivo",className:"block text-sm font-medium text-gray-700",children:"Motivo"}),(0,t.jsx)(c.A,{id:"motivo",value:A.find(o=>o.value===e.motivo_id)||null,options:A,onChange:a=>o({...e,motivo_id:a?a.value:""}),onCreateOption:R,className:"mt-2",placeholder:k?"Cargando motivos...":"Seleccione o cree un motivo",isDisabled:k||0===A.length,noOptionsMessage:()=>"No hay motivos disponibles",formatOptionLabel:e=>(0,t.jsx)("span",{className:"".concat(d(e.label)),children:e.label})})]})]}),"Cambio de Estado por Unidad"===a&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"cantidad_transferir",className:"block text-sm font-medium text-gray-700",children:"Cantidad a Transferir"}),(0,t.jsx)("input",{type:"number",name:"cantidad_transferir",id:"cantidad_transferir",value:e.cantidad_transferir,onChange:a=>o({...e,cantidad_transferir:a.target.value}),className:"mt-2 w-full border border-gray-300 rounded-lg shadow-sm focus:ring-purple-500 focus:border-purple-500",min:"1",max:"N/A"!==L.stock_actual?L.stock_actual:void 0,required:"Cambio de Estado por Unidad"===a})]}),(0,t.jsx)("div",{className:"mt-6",children:(0,t.jsx)("button",{type:"submit",className:"w-full bg-purple-600 text-white py-2 rounded-md shadow hover:bg-purple-700 ".concat(k?"opacity-50 cursor-not-allowed":""),disabled:k,children:k?"Procesando...":"Registrar Movimiento"})})]}),(0,t.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Detalles del Art\xedculo"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Nombre:"})," ",L.nombre]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Categor\xeda:"})," ",L.categoria]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Marca:"})," ",L.marca]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Modelo:"})," ",L.modelo]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Ubicaci\xf3n:"})," ",L.ubicacion]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Estado:"})," ",(0,t.jsx)("span",{className:"".concat(d(L.estado)),children:L.estado})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Descripci\xf3n:"})," ",L.descripcion]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Stock M\xednimo:"})," ",L.stock_minimo]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Stock Actual:"})," ",L.stock_actual]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"C\xf3digo Interno:"})," ",L.codigo_interno]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"C\xf3digo Minvu:"})," ",L.codigo_minvu]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"N\xfamero de Serie:"})," ",L.numero_serie]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"MAC:"})," ",L.mac]})]})]})]})]})}},56598:(e,o,a)=>{"use strict";a.d(o,{A:()=>h});var t=a(58168),i=a(96540),r=a(107),n=a(52836),s=a(89379),l=a(64241),c=a(82305),d=a(49164),m=["allowCreateWhileLoading","createOptionPosition","formatCreateLabel","isValidNewOption","getNewOptionData","onCreateOption","options","onChange"],u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",o=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,t=String(e).toLowerCase(),i=String(a.getOptionValue(o)).toLowerCase(),r=String(a.getOptionLabel(o)).toLowerCase();return i===t||r===t},b={formatCreateLabel:function(e){return'Create "'.concat(e,'"')},isValidNewOption:function(e,o,a,t){return!(!e||o.some(function(o){return u(e,o,t)})||a.some(function(o){return u(e,o,t)}))},getNewOptionData:function(e,o){return{label:o,value:e,__isNew__:!0}}};a(40961),a(27003);var h=(0,i.forwardRef)(function(e,o){var a,u,h,p,g,v,f,_,x,N,C,A,j,w,y,k,E,S,O,L,B,M,D,I,z,P,T,U,V=(h=void 0!==(u=(a=(0,n.u)(e)).allowCreateWhileLoading)&&u,g=void 0===(p=a.createOptionPosition)?"last":p,f=void 0===(v=a.formatCreateLabel)?b.formatCreateLabel:v,x=void 0===(_=a.isValidNewOption)?b.isValidNewOption:_,C=void 0===(N=a.getNewOptionData)?b.getNewOptionData:N,A=a.onCreateOption,w=void 0===(j=a.options)?[]:j,y=a.onChange,S=void 0===(E=(k=(0,c.A)(a,m)).getOptionValue)?r.g:E,L=void 0===(O=k.getOptionLabel)?r.b:O,B=k.inputValue,M=k.isLoading,D=k.isMulti,I=k.value,z=k.name,P=(0,i.useMemo)(function(){return x(B,(0,d.H)(I),w,{getOptionValue:S,getOptionLabel:L})?C(B,f(B)):void 0},[f,C,L,S,B,x,w,I]),T=(0,i.useMemo)(function(){return(h||!M)&&P?"first"===g?[P].concat((0,l.A)(w)):[].concat((0,l.A)(w),[P]):w},[h,g,M,P,w]),U=(0,i.useCallback)(function(e,o){if("select-option"!==o.action)return y(e,o);var a=Array.isArray(e)?e:[e];if(a[a.length-1]===P){if(A)A(B);else{var t=C(B,B);y((0,d.D)(D,[].concat((0,l.A)((0,d.H)(I)),[t]),t),{action:"create-option",name:z,option:t})}return}y(e,o)},[C,B,D,z,P,A,y,I]),(0,s.A)((0,s.A)({},k),{},{options:T,onChange:U}));return i.createElement(r.S,(0,t.A)({ref:o},V))})},46005:(e,o,a)=>{"use strict";a.d(o,{Ay:()=>s});var t=a(52836),i=a(58168),r=a(96540),n=a(107);a(95852),a(40961),a(27003);var s=(0,r.forwardRef)(function(e,o){var a=(0,t.u)(e);return r.createElement(n.S,(0,i.A)({ref:o},a))})}},e=>{var o=o=>e(e.s=o);e.O(0,[563,615,356,23,706,365,636,593,792],()=>o(12480)),_N_E=e.O()}]);